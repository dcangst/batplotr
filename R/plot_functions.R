#' Night Plot
#' 
#' Plot activity (number of calls) over one night.
#'
#' @param plotData data generated by \link{\code{sumBatscopeData}}
#' @param day day to plot in POSIXct format or "YYYY-MM-DD"
#' @param sel_species species_name or vector of species to plot, use "every" to 
#'  plot all species individually (differentiated by color)
#' @return a \code{ggplot} object
#' @family plot functions
#' @export
night_plot <- function(plotData, 
    day=unique(plotData$SurveyDate)[1],
    sel_species="every"){

    if(is.POSIXct(day)==FALSE){
        day <- as.POSIXct(day,format="%Y-%m-%d")
    }
    
    if(sel_species=="every"){
        plotData_sub <- subset(plotData,SurveyDate==day & species!="all")
    } else {
        plotData_sub <- subset(plotData,SurveyDate==day & 
            species %in% sel_species)
    }

    x_limits <- c(plotData_sub$sunset[1]-0.5*3600,
                  plotData_sub$sunrise[1]+0.5*3600)
    #minute(x_limits) <- 0
    #second(x_limits) <- 0
    #hour(x_limits[2]) <- hour(x_limits[2])+1

    y_limits <- c(0,max(plotData$n_events))

    nightPlot <- ggplot(plotData_sub,aes(bins,n_events,fill=species))+
         facet_wrap(~ProjectName)+
         geom_bar(stat="identity",position="dodge",width=300)+
         geom_vline(aes(xintercept=as.numeric(sunset[1])),
             colour="orange")+
         geom_vline(aes(xintercept=as.numeric(sunrise[1])),
             colour="orange")+
         scale_x_datetime(limits=x_limits, breaks=date_breaks("1 hour"),
          labels = date_format("%H:%M"))+
         scale_y_continuous(limits=y_limits)+
         labs(x="Uhrzeit",y="AktivitÃ¤t (# Events)",title=day)+
         theme_light()
    return(nightPlot)
    }
#' Year Plot
#' 
#' Plot activity (number of calls) over one night for every data point.
#'
#' @param plotData data generated by 
#' @family plot functions
#' @export
year_plot <- function(plotData,sunriseData,sunsetData){
        yearPlot <- ggplot(plotData,aes(as.Date(night),timeOfNight_utc))+
            geom_line(data=SR_night,mapping=aes(night,sunrise.ton_utc),
                size=0.3,color="grey25")+
            geom_line(data=SS_night,mapping=aes(night,sunset.ton_utc),
                size=0.3,color="grey25")+
            facet_wrap(~micPos)+
            geom_point(aes(size=n_events),alpha=0.5,color="blue")+
            scale_x_date(limits=as.Date(c("2014-01-01","2015-01-01")))+
            labs(x="Datum",y="Uhrzeit [UTC+1]",title=plotData$species[1])+
            theme_light()
        return(yearPlot)
    }

#' Year Plot
#' 
#' Plot activity (number of calls) over one night for every data point.
#'
#' @param plotData data generated by 
#' @family plot functions
#' @export
year_plot_all <- function(plotData,sunriseData,sunsetData){
    yearPlot <- ggplot(plotData,aes(as.Date(night),timeOfNight_utc,color=species))+
        geom_line(data=SR_night,mapping=aes(night,sunrise.ton_utc),
            size=0.3,color="grey25")+
        geom_line(data=SS_night,mapping=aes(night,sunset.ton_utc),
            size=0.3,color="grey25")+
        facet_wrap(~micPos)+
        geom_point(aes(size=log10(n_events)),alpha=0.5)+
        scale_x_date(limits=as.Date(c("2014-01-01","2015-01-01")))+
        labs(x="Datum",y="Uhrzeit [UTC+1]",title=plotData$species[1])+
        theme_light()
    return(yearPlot)
}